(function(q,n,r){n.module("ibsapp").factory({$takePhoto:["$rootScope",function(k){return function(l,c,r,t,g){"function"===typeof c&&(g=c,c=void 0);var m,h;document.getElementById(l).onchange=function(){if(!this.files[0])return!1;if("jpg"!=this.files[0].type.split("/")[1]&&"jpeg"!=this.files[0].type.split("/")[1]&&"png"!=this.files[0].type.split("/")[1])k.AlertErr("\u8bf7\u4e0a\u4f20jpg,png,jpeg\u7c7b\u578b\u7684\u56fe\u7247");else if($("#load_back_drop").show(),q.FileReader){var p=new FileReader;
    p.readAsDataURL(this.files[0]);p.onload=function(b){b=b.target.result;var e=new Image;e.src=b;e.onload=function(){var b=e.width,f=e.height,a=b*f/5E5;1<a&&(a=Math.sqrt(a),b/=a,f/=a);var a=document.createElement("canvas"),d=a.getContext("2d");b>=f?(a.width=b,a.height=f,d.clearRect(0,0,a.width,a.height),d.drawImage(e,0,0,a.width,a.height)):(a.width=f,a.height=b,d.save(),d.translate(f,0),d.rotate(90*Math.PI/180),d.clearRect(0,0,a.height,a.width),d.drawImage(e,0,0,a.height,a.width));h=a.toDataURL("image/jpeg",
        .5);m=h.replace(/^data:image\/(png|jpeg);base64,/,"");c&&$("#"+c).attr("src",h);"function"===typeof g&&g(l);$("#load_back_drop").hide();h&&k.$broadcast("takephotoFinishEvent",{picinfo:c})}}}else lrz(this.files[0],n.extend({width:800,quality:.5},t)).then(function(b){c&&$("#"+c).attr("src",b.base64);"function"===typeof g&&g(l);$("#load_back_drop").hide();k.$broadcast("takephotoFinishEvent",{picinfo:c})}).catch(function(b){$("#load_back_drop").hide()})};return{getList:function(){return m},clear:function(){m=
    null}}}}]})})(window,window.vx);
